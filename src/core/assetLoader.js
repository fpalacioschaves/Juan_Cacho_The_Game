// src/core/assetLoader.js
function timeout(ms){return new Promise(r=>setTimeout(r,ms))}
function placeholder(label='MISSING',w=320,h=180){const c=document.createElement('canvas');c.width=w;c.height=h;const x=c.getContext('2d');x.fillStyle='#3a2332';x.fillRect(0,0,w,h);x.strokeStyle='#903';x.strokeRect(0,0,w-1,h-1);x.fillStyle='#fff';x.font='20px sans-serif';const tw=x.measureText(label).width;x.fillText(label,(w-tw)/2,h/2);const img=new Image();img.src=c.toDataURL('image/png');return img}
export const Assets={images:new Map(),async loadManifest(m){const e=Object.entries(m?.images||{});await Promise.all(e.map(([k,u])=>this._loadImage(k,u)))},async _loadImage(k,u){const img=new Image();img.decoding='async';img.loading='eager';img.src=u;const ok=await Promise.race([new Promise(res=>{img.onload=()=>res(true);img.onerror=()=>res(false)}),timeout(8000).then(()=>false)]);this.images.set(k, ok?img:placeholder(k,480,270))},get(k){return this.images.get(k)},summary(){return[...this.images.keys()]}}